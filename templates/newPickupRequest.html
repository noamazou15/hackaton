{% extends 'base.html' %}

{% block content %}

<style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
</style>

<form id="packageForm">
    <div class="mb-3">
      <label for="pickupAddress" class="form-label">Pickup Address:</label>
      <input type="text" class="form-control" id="pickupAddress" placeholder="Enter pickup address" required>
    </div>
    <div class="mb-3">
      <label for="dropoffAddress" class="form-label">Dropoff Address:</label>
      <input type="text" class="form-control" id="dropoffAddress" placeholder="Enter dropoff address" required>
    </div>
    <div class="mb-3">
      <label for="packageID" class="form-label">Package ID:</label>
      <input type="text" class="form-control" id="packageID" placeholder="Enter package ID" required>
    </div>
    <div class="mb-3">
      <label for="extraNotes" class="form-label">Extra Notes:</label>
      <textarea class="form-control" id="extraNotes" placeholder="Enter extra notes"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>

<script>
  const form = document.getElementById("packageForm");

  form.addEventListener("submit", function(event) {
    event.preventDefault();

    const pickupAddress = document.getElementById("pickupAddress").value;
    const dropoffAddress = document.getElementById("dropoffAddress").value;
    const packageID = document.getElementById("packageID").value;
    const extraNotes = document.getElementById("extraNotes").value;

    const data = {
      pickup: pickupAddress,
      dropoff: dropoffAddress,
      packageID: packageID,
      notes: extraNotes
    };

    fetch("api/new_package", {
      method: "POST",
      body: JSON.stringify(data),
      headers: {
        "Content-Type": "application/json"
      }
    })
      .then(response => {
        if (response.ok) {
          form.reset(); // Clear the form
          displayMessage("success", "Your package has been submitted successfully.");
        } else {
          displayMessage("error", "Please try again in a few seconds.");
        }
      })
      .catch(error => {
        displayMessage("error", "Please try again in a few seconds.");
        console.error(error);
      });
  });

  function displayMessage(type, message) {
    const messageContainer = document.createElement("div");
    messageContainer.classList.add("alert");

    if (type === "success") {
      messageContainer.classList.add("alert-success");
    } else if (type === "error") {
      messageContainer.classList.add("alert-danger");
    }

    messageContainer.textContent = message;
    document.body.appendChild(messageContainer);

    setTimeout(function() {
      messageContainer.remove();
    }, 5000);
  }
</script>

{% endblock %}